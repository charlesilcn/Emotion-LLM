<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…æ„Ÿåˆ†æç³»ç»Ÿ</title>
    <style>
        /* åŸºç¡€å˜é‡è®¾ç½® */
        :root {
            /* æµ…è‰²æ¨¡å¼å˜é‡ */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --bg-accent: #3b82f6;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --text-tertiary: #6b7280;
            --border-color: #e5e7eb;
            --border-radius: 12px;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        /* æ·±è‰²æ¨¡å¼å˜é‡ */
        .dark {
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --bg-tertiary: #2d2d2d;
            --bg-accent: #3b82f6;
            --text-primary: #f9fafb;
            --text-secondary: #e5e7eb;
            --text-tertiary: #9ca3af;
            --border-color: #374151;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        body {
            font-family: var(--font-sans);
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg-secondary);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--bg-primary);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            padding: 30px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            flex: 1;
        }
        
        /* ä¸»é¢˜åˆ‡æ¢å¼€å…³ */
        .theme-toggle {
            position: relative;
            width: 50px;
            height: 26px;
        }
        
        .theme-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 26px;
            overflow: hidden;
        }
        
        .theme-slider:before {
            position: absolute;
            content: "â˜€ï¸";
            display: flex;
            justify-content: center;
            align-items: center;
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            font-size: 14px;
            line-height: 1;
        }
        
        .theme-slider:after {
            position: absolute;
            content: "ğŸŒ™";
            display: flex;
            justify-content: center;
            align-items: center;
            height: 20px;
            width: 20px;
            right: 3px;
            bottom: 3px;
            opacity: 0;
            transition: .4s;
            font-size: 14px;
            line-height: 1;
            color: white;
        }
        
        input:checked + .theme-slider:before {
            transform: translateX(24px);
            opacity: 0;
        }
        
        input:checked + .theme-slider:after {
            opacity: 1;
        }
        
        input:checked + .theme-slider {
            background-color: var(--bg-accent);
        }
        
        input:checked + .theme-slider:before {
            transform: translateX(24px);
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 24px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 15px;
        }
        
        textarea {
            width: 100%;
            height: 150px;
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 16px;
            resize: vertical;
            font-family: inherit;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--bg-accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        button {
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        
        button:disabled {
            background: var(--border-color);
            color: var(--text-tertiary);
            cursor: not-allowed;
            transform: none;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: none;
            text-align: center;
            padding: 24px;
            color: var(--text-tertiary);
            background-color: var(--bg-tertiary);
            border-radius: var(--border-radius);
            margin-top: 20px;
        }
        
        .loading p {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        /* ç»“æœåŒºåŸŸ */
        .result {
            margin-top: 30px;
            padding: 24px;
            border-radius: var(--border-radius);
            background-color: var(--bg-tertiary);
            display: none;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .result-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .sentiment-badge {
            padding: 6px 16px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .sentiment-positive {
            background-color: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .sentiment-negative {
            background-color: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .sentiment-neutral {
            background-color: rgba(156, 163, 175, 0.2);
            color: #9ca3af;
        }
        
        .result-content {
            margin-top: 20px;
        }
        
        .result-item {
            margin-bottom: 20px;
        }
        
        .result-label {
            font-weight: 600;
            color: var(--text-tertiary);
            margin-bottom: 8px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .result-text {
            background-color: var(--bg-primary);
            padding: 14px;
            border-radius: 8px;
            word-wrap: break-word;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        
        /* åˆ†æ•°æ¡ */
        .score-container {
            margin-top: 20px;
        }
        
        .score-bar {
            width: 100%;
            height: 12px;
            background-color: var(--bg-primary);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--border-color);
        }
        
        .score-fill {
            height: 100%;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 6px;
        }
        
        .score-text {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            color: var(--text-tertiary);
            font-weight: 600;
        }
        
        /* é”™è¯¯æ¶ˆæ¯ */
        .error {
            margin-top: 20px;
            padding: 16px;
            background-color: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--border-radius);
            color: #f87171;
            display: none;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* æ¨¡å‹é€‰æ‹©å®¹å™¨ - Groké£æ ¼ */
        .model-selection-container {
            margin-top: 20px;
            background-color: var(--bg-tertiary);
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }
        
        .model-selection-header {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            padding: 16px;
            font-weight: 700;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .model-selection-content {
            padding: 20px;
        }
        
        .model-dropdown-wrapper {
            position: relative;
            margin-bottom: 20px;
        }
        
        #model-select {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%236b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
        }
        
        #model-select:focus {
            outline: none;
            border-color: var(--bg-accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        #model-select:disabled {
            background-color: var(--bg-tertiary);
            color: var(--text-tertiary);
            cursor: not-allowed;
        }
        
        .model-status-title {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .model-status-icon {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        .model-status-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-primary);
        }
        
        .model-status-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .model-status-item:last-child {
            border-bottom: none;
        }
        
        .model-status-item:hover {
            background-color: var(--bg-tertiary);
        }
        
        .model-status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 12px;
            display: inline-block;
            flex-shrink: 0;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(46, 204, 113, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(46, 204, 113, 0);
            }
        }
        
        .status-connected {
            background-color: #2ecc71;
        }
        
        .status-disconnected {
            background-color: #e74c3c;
            animation: none;
        }
        
        .model-status-name {
            flex-grow: 1;
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .model-status-badge {
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-available {
            background-color: rgba(46, 204, 113, 0.1);
            color: #2ecc71;
        }
        
        .badge-unavailable {
            background-color: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }
        
        .model-tips {
            margin-top: 16px;
            padding: 12px;
            background-color: rgba(59, 130, 246, 0.05);
            border-left: 3px solid var(--bg-accent);
            border-radius: 4px;
            font-size: 13px;
            color: var(--text-tertiary);
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid transparent;
            border-top: 3px solid var(--bg-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                padding: 16px;
            }
            
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }
    </style>
</head>
<body>
    <div class="container">
            <div class="header">
                <h1>æƒ…æ„Ÿåˆ†æç³»ç»Ÿ</h1>
                <label class="theme-toggle">
                    <input type="checkbox" id="theme-toggle">
                    <span class="theme-slider"></span>
                </label>
            </div>
            
            <div class="form-group">
                <label for="text-input">è¯·è¾“å…¥æ–‡æœ¬è¿›è¡Œæƒ…æ„Ÿåˆ†æï¼š</label>
                <textarea id="text-input" placeholder="åœ¨è¿™é‡Œè¾“å…¥ä¸­æ–‡æˆ–è‹±æ–‡æ–‡æœ¬..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="model-select">é€‰æ‹©åˆ†ææ¨¡å‹ï¼š</label>
                <div class="model-selection-container">
                    <div class="model-selection-header">
                        <span>æ¨¡å‹é€‰æ‹©ä¸çŠ¶æ€</span>
                        <div id="modelStatusLoading" class="loading-spinner" style="display: none;"></div>
                    </div>
                    <div class="model-selection-content">
                        <div class="model-dropdown-wrapper">
                            <select id="model-select" disabled>
                                <option value="loading">åŠ è½½ä¸­...</option>
                            </select>
                        </div>
                        
                        <div class="model-status-title">
                            <svg class="model-status-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12.01" y2="8"></line>
                            </svg>
                            æ¨¡å‹è¿æ¥çŠ¶æ€
                        </div>
                        
                        <div id="modelStatus" class="model-status-list">
                            <!-- æ¨¡å‹çŠ¶æ€æŒ‡ç¤ºå™¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                        
                        <div class="model-tips">
                            <strong>æç¤ºï¼š</strong> æœ¬åœ°æ¨¡å‹ä¸ä¾èµ–å¤–éƒ¨ç½‘ç»œï¼Œé€‚åˆä¸­å›½å†…åœ°ä½¿ç”¨ï¼›å…¶ä»–æ¨¡å‹å¯èƒ½éœ€è¦ç½‘ç»œè¿æ¥ã€‚å·²è¿æ¥çš„æ¨¡å‹ä¼šæ˜¾ç¤ºä¸ºå¯ç”¨çŠ¶æ€ã€‚
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="analyze-button" onclick="analyzeText()" disabled>åˆ†ææƒ…æ„Ÿ</button>
        
        <div id="loading" class="loading">
            <p><span class="loading-spinner"></span> æ­£åœ¨åˆ†æä¸­ï¼Œè¯·ç¨å€™...</p>
        </div>
        
        <div id="error-message" class="error">
            <p id="error-text">å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•ã€‚</p>
        </div>
        
        <div id="result" class="result">
            <div class="result-header">
                <div class="result-title">åˆ†æç»“æœ</div>
                <div id="sentiment-badge" class="sentiment-badge">ä¸­æ€§</div>
            </div>
            
            <div class="result-content">
                <div class="result-item">
                    <div class="result-label">åŸå§‹æ–‡æœ¬ï¼š</div>
                    <div id="original-text" class="result-text"></div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">å¤„ç†åæ–‡æœ¬ï¼š</div>
                    <div id="processed-text" class="result-text"></div>
                </div>
                
                <div class="score-container">
                    <div class="result-label">æƒ…æ„Ÿå¾—åˆ†ï¼š</div>
                    <div class="score-bar">
                        <div id="score-fill" class="score-fill" style="width: 50%; background-color: #9ca3af;"></div>
                    </div>
                    <div id="score-text" class="score-text">0.0 (ä¸­æ€§)</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">åˆ†ææ–¹æ³•ï¼š</div>
                    <div id="method-text" class="result-text"></div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">æ£€æµ‹è¯­è¨€ï¼š</div>
                    <div id="language-text" class="result-text"></div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">ä½¿ç”¨æ¨¡å‹ï¼š</div>
                    <div id="model-used-text" class="result-text"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // æ·±è‰²æ¨¡å¼åˆ‡æ¢åŠŸèƒ½
        function setupThemeToggle() {
            const themeToggle = document.getElementById('theme-toggle');
            
            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­çš„ä¸»é¢˜åå¥½
            if (localStorage.getItem('theme') === 'dark' || 
                (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                themeToggle.checked = true;
            }
            
            // ç›‘å¬ä¸»é¢˜åˆ‡æ¢äº‹ä»¶
            themeToggle.addEventListener('change', function() {
                if (this.checked) {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                }
                
                // é‡æ–°æ›´æ–°ç»“æœé¢œè‰²ï¼ˆå¦‚æœæœ‰æ˜¾ç¤ºç»“æœï¼‰
                updateResultColorsOnThemeChange();
            });
        }
        
        // ä¸»é¢˜åˆ‡æ¢æ—¶æ›´æ–°ç»“æœé¢œè‰²
        function updateResultColorsOnThemeChange() {
            const resultElement = document.getElementById('result');
            if (resultElement.style.display === 'block') {
                // è·å–å½“å‰æ˜¾ç¤ºçš„åˆ†æ•°
                const scoreText = document.getElementById('score-text').textContent;
                const scoreMatch = scoreText.match(/-?\d+\.\d+/);
                
                if (scoreMatch) {
                    const score = parseFloat(scoreMatch[0]);
                    const scoreFill = document.getElementById('score-fill');
                    
                    // æ ¹æ®å½“å‰ä¸»é¢˜é‡æ–°è®¡ç®—é¢œè‰²
                    const isDarkMode = document.documentElement.classList.contains('dark');
                    let color;
                    
                    if (score > 0) {
                        // ç§¯ææƒ…ç»ª - ç»¿è‰²ç³»
                        if (isDarkMode) {
                            color = `rgb(${Math.floor(34 - score * 34)}, ${Math.floor(197 + score * 58)}, ${Math.floor(94 - score * 94)})`;
                        } else {
                            color = `rgb(${Math.floor(46 - score * 46)}, ${Math.floor(204 + score * 51)}, ${Math.floor(113 - score * 113)})`;
                        }
                    } else {
                        // æ¶ˆææƒ…ç»ª - çº¢è‰²ç³»
                        if (isDarkMode) {
                            color = `rgb(${Math.floor(239 + score * 199)}, ${Math.floor(68 + score * 68)}, ${Math.floor(68 + score * 68)})`;
                        } else {
                            color = `rgb(${Math.floor(231 + score * 185)}, ${Math.floor(76 + score * 76)}, ${Math.floor(60 + score * 60)})`;
                        }
                    }
                    
                    // æ›´æ–°é¢œè‰²
                    scoreFill.style.backgroundColor = color;
                }
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è·å–æ¨¡å‹åˆ—è¡¨å’ŒçŠ¶æ€
        window.addEventListener('load', function() {
            setupThemeToggle();
            fetchModels();
            // å¯åŠ¨å®šæœŸåˆ·æ–°æ¨¡å‹çŠ¶æ€
            refreshModelStatus();
        });
        
        // è·å–æ¨¡å‹åˆ—è¡¨å’ŒçŠ¶æ€
        function fetchModels() {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('modelStatusLoading').style.display = 'inline-block';
            
            fetch('/models')
                .then(response => response.json())
                .then(data => {
                    // å¤„ç†ä¸åŒæ ¼å¼çš„APIå“åº”
                    let modelsToProcess;
                    if (data.success && data.models) {
                        modelsToProcess = data.models;
                    } else if (data.models) {
                        modelsToProcess = data.models;
                    } else if (Array.isArray(data)) {
                        modelsToProcess = data;
                    } else {
                        modelsToProcess = [];
                    }
                    
                    populateModelSelect(modelsToProcess);
                    displayModelStatus(modelsToProcess);
                    
                    // å¯ç”¨æ¨¡å‹é€‰æ‹©å’Œåˆ†ææŒ‰é’®
                    document.getElementById('model-select').disabled = false;
                    document.getElementById('analyze-button').disabled = false;
                })
                .catch(error => {
                    console.error('è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥:', error);
                    // ä½¿ç”¨é»˜è®¤æ¨¡å‹é€‰é¡¹
                    const modelSelect = document.getElementById('model-select');
                    modelSelect.innerHTML = '';
                    
                    // é»˜è®¤æ¨¡å‹åˆ—è¡¨ï¼ŒåŒ…æ‹¬æ–°å¢çš„è±†åŒ…å’ŒDeepSeekæ¨¡å‹
                    const defaultModels = [
                        { id: 'local_chinese', name: 'æœ¬åœ°ä¸­æ–‡è§„åˆ™æ¨¡å‹ï¼ˆæ¨èï¼Œä¸ä¾èµ–ç½‘ç»œï¼‰', connected: true },
                        { id: 'local_english', name: 'æœ¬åœ°è‹±æ–‡è§„åˆ™æ¨¡å‹ï¼ˆæ¨èï¼Œä¸ä¾èµ–ç½‘ç»œï¼‰', connected: true },
                        { id: 'huggingface_chinese', name: 'Hugging Faceä¸­æ–‡æ¨¡å‹ï¼ˆå¯èƒ½éœ€è¦ç½‘ç»œï¼‰', connected: false },
                        { id: 'ernie_chinese', name: 'ç™¾åº¦ERNIEæ¨¡å‹ï¼ˆå¯¹ä¸­æ–‡æ”¯æŒè¾ƒå¥½ï¼‰', connected: false },
                        { id: 'huggingface_english', name: 'Hugging Faceè‹±æ–‡æ¨¡å‹ï¼ˆå¯èƒ½éœ€è¦ç½‘ç»œï¼‰', connected: false },
                        { id: 'doubao_chinese', name: 'è±†åŒ…ä¸­æ–‡æ¨¡å‹', connected: false },
                        { id: 'deepseek_chinese', name: 'DeepSeekä¸­æ–‡æ¨¡å‹', connected: false }
                    ];
                    
                    populateModelSelect(defaultModels);
                    displayModelStatus(defaultModels);
                    
                    modelSelect.disabled = false;
                    document.getElementById('analyze-button').disabled = false;
                });
        }
        
        // å®šæœŸåˆ·æ–°æ¨¡å‹çŠ¶æ€
        function refreshModelStatus() {
            fetch('/models')
                .then(response => response.json())
                .then(data => {
                    // å¤„ç†ä¸åŒæ ¼å¼çš„APIå“åº”
                    let modelsToProcess;
                    if (data.success && data.models) {
                        modelsToProcess = data.models;
                    } else if (data.models) {
                        modelsToProcess = data.models;
                    } else if (Array.isArray(data)) {
                        modelsToProcess = data;
                    } else {
                        return;
                    }
                    
                    // æ›´æ–°ç°æœ‰æ¨¡å‹çš„çŠ¶æ€
                    modelsToProcess.forEach(model => {
                        const modelItem = document.querySelector(`.model-status-item[data-model-id="${model.id}"]`);
                        if (modelItem) {
                            const indicator = modelItem.querySelector('.model-status-indicator');
                            if (indicator) {
                                indicator.className = 'model-status-indicator ' + 
                                    (model.connected ? 'status-connected' : 'status-disconnected');
                                indicator.title = model.connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥';
                            }
                            
                            // æ›´æ–°çŠ¶æ€æ ‡ç­¾
                            const statusBadge = modelItem.querySelector('.model-status-badge');
                            if (statusBadge) {
                                statusBadge.className = 'model-status-badge ' + 
                                    (model.connected ? 'badge-available' : 'badge-unavailable');
                                statusBadge.textContent = model.connected ? 'å¯ç”¨' : 'ä¸å¯ç”¨';
                            }
                        }
                        
                        // æ›´æ–°ä¸‹æ‹‰é€‰é¡¹
                        const option = document.querySelector(`#model-select option[value="${model.id}"]`);
                        if (option) {
                            option.disabled = !model.connected;
                        }
                    });
                })
                .catch(error => {
                    console.error('åˆ·æ–°æ¨¡å‹çŠ¶æ€å¤±è´¥:', error);
                });
            
            // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡
            setTimeout(refreshModelStatus, 30000);
        }
        
        // å¡«å……æ¨¡å‹é€‰æ‹©ä¸‹æ‹‰æ¡†
        function populateModelSelect(models) {
            const modelSelect = document.getElementById('model-select');
            modelSelect.innerHTML = '';
            
            models.forEach(model => {
                const option = document.createElement('option');
                option.value = model.id;
                option.textContent = model.name;
                option.disabled = !model.connected;
                
                // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨çš„æœ¬åœ°ä¸­æ–‡æ¨¡å‹
                if (model.id === 'local_chinese' && model.connected) {
                    option.selected = true;
                }
                
                modelSelect.appendChild(option);
            });
        }
        
        // æ˜¾ç¤ºæ¨¡å‹çŠ¶æ€
        function displayModelStatus(models) {
            const statusContainer = document.getElementById('modelStatus');
            statusContainer.innerHTML = '';
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('modelStatusLoading').style.display = 'none';
            
            models.forEach(model => {
                const modelItem = document.createElement('div');
                modelItem.className = 'model-status-item';
                modelItem.dataset.modelId = model.id; // æ·»åŠ æ•°æ®å±æ€§ä»¥ä¾¿äºæ›´æ–°
                
                const indicator = document.createElement('span');
                indicator.className = 'model-status-indicator ' + 
                    (model.connected ? 'status-connected' : 'status-disconnected');
                indicator.title = model.connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥';
                
                const modelName = document.createElement('span');
                modelName.className = 'model-status-name';
                modelName.textContent = model.name;
                
                const statusBadge = document.createElement('span');
                statusBadge.className = 'model-status-badge ' + 
                    (model.connected ? 'badge-available' : 'badge-unavailable');
                statusBadge.textContent = model.connected ? 'å¯ç”¨' : 'ä¸å¯ç”¨';
                
                modelItem.appendChild(indicator);
                modelItem.appendChild(modelName);
                modelItem.appendChild(statusBadge);
                
                statusContainer.appendChild(modelItem);
            });
        }
        
        function analyzeText() {
            const text = document.getElementById('text-input').value.trim();
            const model = document.getElementById('model-select').value;
            const button = document.getElementById('analyze-button');
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            const errorMessage = document.getElementById('error-message');
            
            // é‡ç½®çŠ¶æ€
            result.style.display = 'none';
            errorMessage.style.display = 'none';
            
            // éªŒè¯è¾“å…¥
            if (!text) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„æ–‡æœ¬');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            button.disabled = true;
            loading.style.display = 'block';
            
            // å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨
            fetch('/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ text: text, model_id: model })
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(error => Promise.reject(error));
                }
                return response.json();
            })
            .then(data => {
                // éšè—åŠ è½½çŠ¶æ€
                button.disabled = false;
                loading.style.display = 'none';
                
                if (data.success) {
                    // æ˜¾ç¤ºç»“æœ
                    displayResult(data);
                } else {
                    // æ˜¾ç¤ºé”™è¯¯
                    showError(data.error || 'åˆ†æå¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            })
            .catch(error => {
                // éšè—åŠ è½½çŠ¶æ€
                button.disabled = false;
                loading.style.display = 'none';
                
                // æ˜¾ç¤ºé”™è¯¯
                showError(error.error || 'ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•');
                console.error('Error:', error);
            });
        }
        
        function showError(message) {
            const errorText = document.getElementById('error-text');
            const errorMessage = document.getElementById('error-message');
            
            errorText.textContent = message;
            errorMessage.style.display = 'block';
        }
        
        function displayResult(data) {
            const result = document.getElementById('result');
            const sentimentBadge = document.getElementById('sentiment-badge');
            const originalText = document.getElementById('original-text');
            const processedText = document.getElementById('processed-text');
            const scoreFill = document.getElementById('score-fill');
            const scoreText = document.getElementById('score-text');
            const methodText = document.getElementById('method-text');
            const languageText = document.getElementById('language-text');
            const modelUsedText = document.getElementById('model-used-text');
            
            // è®¾ç½®æƒ…æ„Ÿæ ‡ç­¾
            sentimentBadge.textContent = getSentimentLabel(data.sentiment);
            sentimentBadge.className = `sentiment-badge sentiment-${data.sentiment}`;
            
            // è®¾ç½®æ–‡æœ¬å†…å®¹
            originalText.textContent = data.original_text;
            processedText.textContent = data.processed_text || 'æ— ';
            methodText.textContent = data.method;
            languageText.textContent = data.language === 'chinese' ? 'ä¸­æ–‡' : 'è‹±æ–‡';
            modelUsedText.textContent = data.model_display_name || data.model_used || 'é»˜è®¤æ¨¡å‹';
            
            // è®¾ç½®åˆ†æ•°æ¡
            const score = data.score || 0;
            const percentage = (score + 1) / 2 * 100; // å°† -1 åˆ° 1 çš„åˆ†æ•°æ˜ å°„åˆ° 0% åˆ° 100%
            
            // æ ¹æ®åˆ†æ•°è®¾ç½®é¢œè‰²ï¼Œé€‚é…æ·±è‰²æ¨¡å¼
            const isDarkMode = document.documentElement.classList.contains('dark');
            let color;
            
            if (score > 0) {
                // ç§¯ææƒ…ç»ª - ç»¿è‰²ç³»
                if (isDarkMode) {
                    // æ·±è‰²æ¨¡å¼ä¸‹æ›´äº®çš„ç»¿è‰²
                    color = `rgb(${Math.floor(34 - score * 34)}, ${Math.floor(197 + score * 58)}, ${Math.floor(94 - score * 94)})`;
                } else {
                    color = `rgb(${Math.floor(46 - score * 46)}, ${Math.floor(204 + score * 51)}, ${Math.floor(113 - score * 113)})`;
                }
            } else {
                // æ¶ˆææƒ…ç»ª - çº¢è‰²ç³»
                if (isDarkMode) {
                    // æ·±è‰²æ¨¡å¼ä¸‹æ›´äº®çš„çº¢è‰²
                    color = `rgb(${Math.floor(239 + score * 199)}, ${Math.floor(68 + score * 68)}, ${Math.floor(68 + score * 68)})`;
                } else {
                    color = `rgb(${Math.floor(231 + score * 185)}, ${Math.floor(76 + score * 76)}, ${Math.floor(60 + score * 60)})`;
                }
            }
            
            scoreFill.style.width = `${percentage}%`;
            scoreFill.style.backgroundColor = color;
            scoreText.textContent = `${score.toFixed(2)} (${getSentimentLabel(data.sentiment)})`;
            
            // æ˜¾ç¤ºç»“æœ
            result.style.display = 'block';
        }
        
        function getSentimentLabel(sentiment) {
            switch(sentiment) {
                case 'positive':
                    return 'ç§¯æ';
                case 'negative':
                    return 'æ¶ˆæ';
                case 'neutral':
                    return 'ä¸­æ€§';
                default:
                    return 'æœªçŸ¥';
            }
        }
        
        // æ·»åŠ å›è½¦+Ctrlå¿«æ·é”®æäº¤
        document.getElementById('text-input').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                analyzeText();
            }
        });
    </script>
</body>
</html>